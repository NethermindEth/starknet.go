# StateUpdate

Gets the state changes that occurred in a specific block.

## Method Signature

```go
func (provider *Provider) StateUpdate(ctx context.Context, blockID BlockID) (*StateUpdateOutput, error)
```

## Parameters

- `ctx` - Context for request cancellation and timeout
- `blockID` - Block identifier (number, hash, or tag)

## Returns

- `*StateUpdateOutput` - State changes in the block
- `error` - Error if the request fails

## BlockID Parameter

This method requires a `BlockID` parameter. The RPC package provides helper functions to create BlockID:

```go
// Using block number
blockID := rpc.WithBlockNumber(123456)

// Using block hash
hash, _ := new(felt.Felt).SetString("0x1234...")
blockID := rpc.WithBlockHash(hash)

// Using block tag
blockID := rpc.WithBlockTag("latest")
```

**See [RPC Helper Functions](/docs/rpc/helper-functions) for detailed documentation of these helper functions.**

## Usage Example

```go
package main

import (
    "context"
    "encoding/json"
    "fmt"
    "log"

    "github.com/NethermindEth/starknet.go/rpc"
)

func main() {
    // Create RPC client
    client, err := rpc.NewProvider("https://starknet-sepolia.public.blastapi.io/rpc/v0_8")
    if err != nil {
        log.Fatal("Failed to create client:", err)
    }

    // Get state update for latest block
    blockID := rpc.WithBlockTag("latest")
    stateUpdate, err := client.StateUpdate(context.Background(), blockID)
    if err != nil {
        log.Fatal("Failed to get state update:", err)
    }

    // Pretty print the state changes
    updateJSON, _ := json.MarshalIndent(stateUpdate, "", "  ")
    fmt.Printf("State update:\n%s\n", updateJSON)
}
```

## Expected Output

```json
{
  "block_hash": "0x54be24b0d6fc6a2622d6691cf6ca2c2a9c222bd060059c71fd86401474d6645",
  "new_root": "0x51a87db3eaa72204fc55d3ae688ad6726f8c336d7a00eee9e8c8856a12ffd2a",
  "old_root": "0x739a6b4805d3601e11dc486dc0c77108713aeb276869f99c1f043ce9a8ce2b9",
  "state_diff": {
    "storage_diffs": [
      {
        "address": "0x21d980d405158f62464649ce2c8a433e1c61096d7ca045d70a9b70c8923700d",
        "storage_entries": [
          {
            "key": "0x31b",
            "value": "0x1b00be18273be7b9ed2606e1c2c7280f39a1f97aadd0d6a9868c49305cce8f9"
          }
        ]
      },
      {
        "address": "0x4718f5a0fc34cc1af16a1cdee98ffb20c31f5cd61d6ab07201858f4287c938d",
        "storage_entries": [
          {
            "key": "0x1bc06e01c8edbc022b2a63178e2e2f2bc1bc498a6b2fa743a0e99ec2be6ac16",
            "value": "0x461c4f2d8b6c1a0f4de9"
          },
          {
            "key": "0x5496768776e3db30053404f18067d81a6e06f5a2b0de326e21298fd9d569a9a",
            "value": "0x265f9b3e4ed92d69eb330"
          }
        ]
      },
      {
        "address": "0x1",
        "storage_entries": [
          {
            "key": "0x29b7ad",
            "value": "0x61526c54517b4d7c45b194e4690504759d01c18d916ccdde05a08ecc6bfaefd"
          }
        ]
      }
    ],
    "deprecated_declared_classes": [],
    "declared_classes": [],
    "deployed_contracts": [],
    "replaced_classes": [],
    "nonces": [
      {
        "contract_address": "0x395a96a5b6343fc0f543692fd36e7034b54c2a276cd1a021e8c0b02aee1f43",
        "nonce": "0x858c3a"
      }
    ]
  }
}
```

Shows the old and new state roots, plus all state changes including storage updates, contract deployments, and nonce changes.

## Advanced Examples

For comprehensive state analysis examples, see [Block Analysis Examples](/docs/examples/block-analysis#state-changes-analysis).

## StateUpdateOutput Structure

**Root Information:**
- `block_hash` - Hash of the block containing these changes
- `old_root` - State root before applying transactions
- `new_root` - State root after applying all transactions

**State Diff Components:**
- `storage_diffs` - Storage slot changes per contract address
- `declared_classes` - New contract classes declared
- `deprecated_declared_classes` - Legacy declared classes
- `deployed_contracts` - New contract instances deployed
- `replaced_classes` - Contract class upgrades
- `nonces` - Account nonce updates

## Error Handling

```go
stateUpdate, err := client.StateUpdate(ctx, blockID)
if err != nil {
    log.Printf("Error getting state update: %v", err)
    return
}

if stateUpdate == nil {
    log.Printf("No state update returned")
    return
}

fmt.Printf("Processing state changes from %s to %s\n", 
    stateUpdate.OldRoot.String(), stateUpdate.NewRoot.String())
```

## Performance Notes

- Can return large amounts of data for blocks with many state changes
- Consider filtering or processing data incrementally for busy blocks
- State updates are essential for maintaining synchronized state
- Empty arrays indicate no changes of that type occurred