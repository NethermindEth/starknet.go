# BlockWithReceipts

Gets a block with both full transaction details and their corresponding receipts. This is the most comprehensive block query method, providing complete information about transactions and their execution results including gas usage, events emitted, execution status, and fees paid. Each transaction is paired with its receipt, making this ideal for analyzing transaction outcomes. 

## Method Signature

```go
func (provider *Provider) BlockWithReceipts(
    ctx context.Context,
    blockID BlockID,
) (interface{}, error)
```

**Source:** [block.go:L214-L244](https://github.com/NethermindEth/starknet.go/blob/main/rpc/block.go#L214-L244)

## Parameters

- `ctx` (context.Context): Context for request cancellation and timeout
- `blockID` (BlockID): Block identifier (number, hash, or tag like "latest" or "pending")

## Returns

- `interface{}`: The retrieved block (either `*BlockWithReceipts` or `*PreConfirmedBlockWithReceipts`)
- `error`: Error if the request fails

:::note
The method can return either a confirmed block (`BlockWithReceipts`) or a pre-confirmed block (`PreConfirmedBlockWithReceipts`) depending on the block status. This can return `ErrBlockNotFound` if the specified block doesn't exist.
:::

## Type Definitions

### BlockID

The `blockID` parameter specifies which block to retrieve. You can identify a block in three ways:

```go
type BlockID struct {
    Number *uint64    `json:"block_number,omitempty"`
    Hash   *felt.Felt `json:"block_hash,omitempty"`
    Tag    BlockTag   `json:"tag,omitempty"`
}
```

**Source:** [types_block.go:L130-L136](https://github.com/NethermindEth/starknet.go/blob/main/rpc/types_block.go#L130-L136)

There are helper functions for creating `BlockID`. So Instead of manually creating the `BlockID` struct, use these convenience functions.

-  By Block Number - Get a specific block by its height

    ```go
    blockID := rpc.WithBlockNumber(123456)
    ```
    Source: [block.go:L59-L64](https://github.com/NethermindEth/starknet.go/blob/main/rpc/block.go#L59-L64)

-  By Block Hash - Get a specific block by its hash

    ```go
    hash, _ := new(felt.Felt).SetString("0x1234...")
    blockID := rpc.WithBlockHash(hash)
    ```
    Source: [block.go:L73-L78](https://github.com/NethermindEth/starknet.go/blob/main/rpc/block.go#L73-L78)

- By Block Tag - Get a dynamic block reference
    ```go
    blockID := rpc.WithBlockTag("latest")      // Latest accepted block
    blockID := rpc.WithBlockTag("pending")     // Block currently being built
    ```
    Source: [block.go:L87-L92](https://github.com/NethermindEth/starknet.go/blob/main/rpc/block.go#L87-L92)
### BlockWithReceipts

```go
type BlockWithReceipts struct {
    BlockHeader
    Status BlockStatus `json:"status"`
    BlockBodyWithReceipts
}
```

**Source:** [types_block.go:L29-L33](https://github.com/NethermindEth/starknet.go/blob/main/rpc/types_block.go#L29-L33)

## Usage Example

```go
package main

import (
    "context"
    "encoding/json"
    "fmt"
    "log"
    "os"

    "github.com/NethermindEth/starknet.go/rpc"
    "github.com/joho/godotenv"
)

func main() {
    // Load environment variables from .env file
    err := godotenv.Load()
    if err != nil {
        log.Fatal("Error loading .env file")
    }

    // Get RPC URL from environment variable
    rpcURL := os.Getenv("STARKNET_RPC_URL")
    if rpcURL == "" {
        log.Fatal("STARKNET_RPC_URL not found in .env file")
    }

    // Initialize provider
    provider, err := rpc.NewProvider(context.Background(), rpcURL)
    if err != nil {
        log.Fatal(err)
    }

    // Get latest block with receipts
    blockID := rpc.WithBlockTag("latest")
    block, err := provider.BlockWithReceipts(context.Background(), blockID)
    if err != nil {
        log.Fatal(err)
    }

    // Pretty print the result
    blockJSON, _ := json.MarshalIndent(block, "", "  ")
    fmt.Printf("Block with receipts:\n%s\n", blockJSON)
}
```

:::note
Create a `.env` file in your project root and install the godotenv package to run the code snippet.
:::

## Error Handling

```go
block, err := provider.BlockWithReceipts(ctx, blockID)
if err != nil {
    switch {
    case errors.Is(err, rpc.ErrBlockNotFound):
        log.Printf("Block not found")
    default:
        log.Printf("Failed to get block: %v", err)
    }
    return
}

fmt.Printf("Successfully retrieved block with transactions and receipts\n")
```

## Common Use Cases

- Analyzing complete transaction execution including gas costs and events. See [example](/docs/rpc/examples#transaction-outcome-analysis).
- Analyzing gas usage patterns and costs across all transactions in a block.
- Verifying transaction execution status and results for auditing purposes.
