# BuildTransaction

Prepares a transaction with paymaster sponsorship details. Takes the user's intended transaction calls and returns typed data that includes paymaster sponsorship, along with fee estimates and a tracking ID for monitoring.

## Method Signature

```go
func (pm *Paymaster) BuildTransaction(
    ctx context.Context,
    request *BuildTransactionRequest,
) (BuildTransactionResponse, error)
```

**Source:** [build_txn.go:L24-L45](https://github.com/NethermindEth/starknet.go/blob/main/paymaster/build_txn.go#L24-L45)

## Parameters

- `ctx` (context.Context): Context for the operation
- `request` (*BuildTransactionRequest): Transaction build request containing the transaction and execution parameters

## Returns

- `BuildTransactionResponse`: Response containing typed data, fee estimates, and tracking ID
- `error`: Error if build fails

## Usage Example

```go
package main

import (
	"context"
	"fmt"
	"log"

	"github.com/NethermindEth/juno/core/felt"
	"github.com/NethermindEth/starknet.go/paymaster"
)

func main() {
	// Connect to AVNU's public paymaster service on Sepolia testnet
	paymasterURL := "https://sepolia.paymaster.avnu.fi"
	ctx := context.Background()

	fmt.Printf("Paymaster Build Transaction Example\n")
	fmt.Printf("====================================\n\n")

	// Create paymaster client
	pm, err := paymaster.New(ctx, paymasterURL)
	if err != nil {
		log.Fatalf("Failed to create paymaster client: %v", err)
	}

	fmt.Println("Paymaster client created")

	// Build a transaction request
	// This example shows the structure for an invoke transaction
	userAddress, _ := new(felt.Felt).SetString("0x1234...")
	contractAddress, _ := new(felt.Felt).SetString("0x5678...")

	// Use ETH token address on Sepolia (from GetSupportedTokens)
	gasToken, _ := new(felt.Felt).SetString("0x049d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7")

	request := &paymaster.BuildTransactionRequest{
		Transaction: paymaster.UserTransaction{
			Type: paymaster.UserTxnInvoke,
			Invoke: &paymaster.UserInvoke{
				UserAddress: userAddress,
				Calls: []paymaster.Call{
					{
						To:       contractAddress,
						Selector: new(felt.Felt).SetUint64(1), // transfer selector
						Calldata: []*felt.Felt{},
					},
				},
			},
		},
		Parameters: paymaster.UserParameters{
			Version: paymaster.UserParamV1,
			FeeMode: paymaster.FeeMode{
				Mode:     paymaster.FeeModeDefault,
				GasToken: gasToken,
			},
		},
	}

	fmt.Println("\nBuilding transaction with paymaster...")

	// Build the transaction
	// Note: This will fail with placeholder addresses, but demonstrates the structure
	response, err := pm.BuildTransaction(ctx, request)
	if err != nil {
		// Expected error with placeholder addresses:
		// "contract not found" or "TRANSACTION_EXECUTION_ERROR"
		fmt.Printf("Build failed (expected with placeholder addresses): %v\n", err)
		fmt.Println("\nTo use with real addresses:")
		fmt.Println("1. Replace userAddress with your actual account address")
		fmt.Println("2. Replace contractAddress with target contract")
		fmt.Println("3. Update selector and calldata for your specific call")
		return
	}

	fmt.Println("Transaction built successfully")
	fmt.Printf("\nTyped Data: %v\n", response.TypedData != nil)
	fmt.Printf("Fee Estimate: %v\n", response.Fee != nil)
}
```

## Common Use Cases

- Build gasless transactions with paymaster sponsorship by including the returned typed data and fee estimates.
- Obtain fee calculations and estimates before executing transactions to display to users.
- Generate tracking IDs for monitoring transaction status through the paymaster service.
- Must be called before ExecuteTransaction to get the properly formatted typed data for signing.
- PaymasterData and tracking ID from the response are required for successful transaction execution.

